{% extends "base.html" %}

{% block title %}Planificateur de menus - Routinerie{% endblock %}

{% block content %}
<div class="menu-grid">
    <table class="menu-table">
        <thead>
            <tr>
                <th class="week-nav-cell" rowspan="3">
                    <div class="week-navigation-compact">
                        <button class="btn-nav" id="prev-week" title="Semaine pr√©c√©dente">‚óÄ</button>
                        <span class="current-week-compact">Sem {{ semaine.isocalendar()[1] }}</span>
                        <button class="btn-nav" id="next-week" title="Semaine suivante">‚ñ∂</button>
                    </div>
                </th>
                {% for jour in jours %}
                <th>
                    <div>{{ jour|capitalize }}</div>
                    <div class="date-jour">{{ dates[jour].strftime('%d/%m') }}</div>
                </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for moment in moments %}
            <tr>
                <th>{{ moment|capitalize }}</th>
                {% for jour in jours %}
                <td class="menu-cell{% if menus[jour][moment] and menus[jour][moment].recette %} has-menu{% endif %}" 
                    data-jour="{{ jour }}" data-moment="{{ moment }}"
                    {% if menus[jour][moment] %}
                    data-menu-id="{{ menus[jour][moment].id }}"
                    {% if menus[jour][moment].recette %}
                    data-recette-id="{{ menus[jour][moment].recette.id }}"
                    draggable="true"
                    {% endif %}
                    {% endif %}>
                    {% if menus[jour][moment] %}
                        <div class="menu-content">
                            {% if menus[jour][moment].recette %}
                                <strong>{{ menus[jour][moment].recette.nom }}</strong>
                            {% else %}
                                {{ menus[jour][moment].description or 'Cliquez pour ajouter' }}
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="menu-content empty">
                            Cliquez pour ajouter
                        </div>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Boutons pour afficher les listes -->
<div style="margin-top: 1rem; text-align: center; display: flex; gap: 1rem; justify-content: center;">
    <button type="button" class="btn btn-primary" id="show-recipes-list-btn" title="Liste des recettes">üìã</button>
    <button type="button" class="btn btn-primary" id="show-ingredients-list-btn" title="Liste des ingr√©dients">ü•ï</button>
    <button type="button" class="btn btn-primary" id="show-shopping-list-btn" title="Liste de courses">üõí</button>
</div>

<!-- Modal pour √©diter un menu -->
<div id="menu-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <form id="menu-form">
            <input type="hidden" id="menu-jour">
            <input type="hidden" id="menu-moment">
            <input type="hidden" id="menu-semaine" value="{{ semaine }}">
            
            <div class="form-group">
                <label for="menu-recette-search">Recette:</label>
                <div style="position: relative;">
                    <input type="text" id="menu-recette-search" placeholder="Rechercher une recette..." autocomplete="off" style="width: 100%;">
                    <input type="hidden" id="menu-recette">
                    <div id="menu-recette-suggestions" class="ingredient-suggestions" style="display: none;"></div>
                </div>
            </div>
            
            <!-- D√©tails de la recette -->
            <div id="menu-recette-details" style="display: none; margin-top: 1rem;">
                <div class="form-group">
                    <label>Instructions:</label>
                    <div id="menu-recette-instructions" style="padding: 0.75rem; background: #f8f9fa; border-radius: 5px; white-space: pre-wrap;"></div>
                </div>
                
                <div class="form-group">
                    <label>Ingr√©dients:</label>
                    <div id="menu-recette-ingredients" style="padding: 0.75rem; background: #f8f9fa; border-radius: 5px;"></div>
                </div>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                <div style="display: flex; gap: 0.5rem;">
                    <button type="submit" class="btn-icon btn-icon-success" title="Enregistrer">‚úî</button>
                    <button type="button" class="btn-icon btn-icon-danger" id="delete-menu" style="display:none;" title="Supprimer">üóë</button>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button type="button" class="btn-icon btn-icon-secondary" id="create-recipe-btn" title="Cr√©er une nouvelle recette">+</button>
                    <button type="button" class="btn-icon btn-icon-info" id="edit-recipe-btn" style="display:none;" title="Modifier la recette">‚úèÔ∏è</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Modal pour cr√©er une recette -->
<div id="recette-modal" class="modal">
    <div class="modal-content">
        <span class="close" data-modal="recette-modal">&times;</span>
        <h3>Cr√©er une recette</h3>
        <form id="recette-form">
            <div class="form-group">
                <label for="recette-nom">Nom de la recette:</label>
                <input type="text" id="recette-nom" required>
            </div>
            
            <div class="form-group">
                <label for="recette-description">Instructions:</label>
                <textarea id="recette-description" rows="5"></textarea>
            </div>
            
            <div class="form-group">
                <label>Ingr√©dients:</label>
                <div id="ingredients-list"></div>
                <div style="position: relative; margin-top: 0.5rem;">
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="ingredient-search" placeholder="Rechercher un ingr√©dient..." autocomplete="off" style="flex: 1;">
                        <button type="button" class="btn btn-secondary" id="add-ingredient-btn">+</button>
                    </div>
                    <div id="ingredient-suggestions" class="ingredient-suggestions" style="display: none;"></div>
                </div>
                <button type="button" class="btn btn-secondary" id="create-ingredient-btn" style="margin-top: 0.5rem; width: 100%;">Cr√©er un nouvel ingr√©dient</button>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Cr√©er et s√©lectionner</button>
                <button type="button" class="btn btn-secondary" id="cancel-recette">Annuler</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal pour modifier une recette -->
<div id="edit-recette-modal" class="modal">
    <div class="modal-content" style="max-width: 1200px;">
        <span class="close" data-modal="edit-recette-modal">&times;</span>
        <h3>Modifier la recette</h3>
        <form id="edit-recette-form">
            <input type="hidden" id="edit-recette-id">
            
            <div class="form-group">
                <label for="edit-recette-nom">Nom de la recette:</label>
                <input type="text" id="edit-recette-nom" required>
            </div>
            
            <div class="form-group">
                <label for="edit-recette-description">Instructions:</label>
                <textarea id="edit-recette-description" rows="5"></textarea>
            </div>
            
            <div class="form-group">
                <label>Ingr√©dients:</label>
                <div id="edit-ingredients-list"></div>
                <div style="position: relative; margin-top: 0.5rem;">
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="edit-ingredient-search" placeholder="Rechercher un ingr√©dient..." autocomplete="off" style="flex: 1;">
                        <button type="button" class="btn btn-secondary" id="edit-add-ingredient-btn">+</button>
                    </div>
                    <div id="edit-ingredient-suggestions" class="ingredient-suggestions" style="display: none;"></div>
                </div>
                <button type="button" class="btn btn-secondary" id="edit-create-ingredient-btn" style="margin-top: 0.5rem; width: 100%;">Cr√©er un nouvel ingr√©dient</button>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn-icon" style="background-color: #27ae60;">‚úî</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal pour cr√©er un ingr√©dient -->
<div id="ingredient-modal" class="modal">
    <div class="modal-content">
        <span class="close" data-modal="ingredient-modal">&times;</span>
        <h3>Cr√©er un ingr√©dient</h3>
        <form id="ingredient-form">
            <div class="form-group">
                <label for="ingredient-nom">Nom de l'ingr√©dient:</label>
                <input type="text" id="ingredient-nom" required>
            </div>
            
            <div class="form-group">
                <label for="ingredient-categorie">Cat√©gorie:</label>
                <select id="ingredient-categorie" required>
                    <option value="L√©gumes">L√©gumes</option>
                    <option value="Fruits">Fruits</option>
                    <option value="Viandes">Viandes</option>
                    <option value="Poissons">Poissons</option>
                    <option value="Produits laitiers">Produits laitiers</option>
                    <option value="C√©r√©ales & F√©culents">C√©r√©ales & F√©culents</option>
                    <option value="√âpices & Condiments">√âpices & Condiments</option>
                    <option value="Huiles & Mati√®res grasses">Huiles & Mati√®res grasses</option>
                    <option value="Sucres & Produits sucr√©s">Sucres & Produits sucr√©s</option>
                    <option value="Boissons">Boissons</option>
                    <option value="Autre">Autre</option>
                </select>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Cr√©er</button>
                <button type="button" class="btn btn-secondary" id="cancel-ingredient">Annuler</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal pour modifier un ingr√©dient -->
<div id="edit-ingredient-modal" class="modal">
    <div class="modal-content">
        <span class="close" data-modal="edit-ingredient-modal">&times;</span>
        <h3>Modifier l'ingr√©dient</h3>
        <form id="edit-ingredient-form">
            <input type="hidden" id="edit-ingredient-id">
            <div class="form-group">
                <label for="edit-ingredient-nom">Nom de l'ingr√©dient:</label>
                <input type="text" id="edit-ingredient-nom" required>
            </div>
            
            <div class="form-group">
                <label for="edit-ingredient-categorie">Cat√©gorie:</label>
                <select id="edit-ingredient-categorie" required>
                    <option value="L√©gumes">L√©gumes</option>
                    <option value="Fruits">Fruits</option>
                    <option value="Viandes">Viandes</option>
                    <option value="Poissons">Poissons</option>
                    <option value="Produits laitiers">Produits laitiers</option>
                    <option value="C√©r√©ales & F√©culents">C√©r√©ales & F√©culents</option>
                    <option value="√âpices & Condiments">√âpices & Condiments</option>
                    <option value="Huiles & Mati√®res grasses">Huiles & Mati√®res grasses</option>
                    <option value="Sucres & Produits sucr√©s">Sucres & Produits sucr√©s</option>
                    <option value="Boissons">Boissons</option>
                    <option value="Autre">Autre</option>
                </select>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn-icon" style="background-color: #27ae60;">‚úî</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal pour afficher la liste des recettes -->
<div id="recipes-list-modal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <span class="close" data-modal="recipes-list-modal">&times;</span>
        <h3>Liste des recettes</h3>
        <div id="recipes-list-container" style="margin-top: 1rem;">
            <!-- Les recettes seront charg√©es ici par JavaScript -->
        </div>
    </div>
</div>

<!-- Modal pour afficher la liste des ingr√©dients -->
<div id="ingredients-list-modal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <span class="close" data-modal="ingredients-list-modal">&times;</span>
        <h3>Liste des ingr√©dients</h3>
        <div id="ingredients-list-container" style="margin-top: 1rem;">
            <!-- Les ingr√©dients seront charg√©s ici par JavaScript -->
        </div>
    </div>
</div>

<!-- Modal pour afficher la liste de courses de la semaine -->
<div id="shopping-list-modal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <span class="close" data-modal="shopping-list-modal">&times;</span>
        <h3>Liste de courses de la semaine</h3>
        <div id="shopping-list-container" style="margin-top: 1rem;">
            <!-- La liste de courses sera charg√©e ici par JavaScript -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/planner.js') }}"></script>
{% endblock %}
