{% extends "base.html" %}

{% block title %}Planificateur de menus - Routinerie{% endblock %}

{% block content %}
<div class="menu-grid">
    <table class="menu-table">
        <thead>
            <tr>
                <th class="week-nav-cell" rowspan="3">
                    <div class="week-navigation-compact">
                        <button class="btn-nav" id="prev-week" title="Semaine pr√©c√©dente">‚óÄ</button>
                        <span class="current-week-compact">Sem {{ semaine.isocalendar()[1] }}</span>
                        <button class="btn-nav" id="next-week" title="Semaine suivante">‚ñ∂</button>
                    </div>
                </th>
                {% for jour in jours %}
                <th>
                    <div>{{ jour|capitalize }}</div>
                    <div class="date-jour">{{ dates[jour].strftime('%d/%m') }}</div>
                </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for moment in moments %}
            <tr>
                <th>{{ moment|capitalize }}</th>
                {% for jour in jours %}
                <td class="menu-cell{% if menus[jour][moment] and menus[jour][moment].recette %} has-menu{% endif %}" 
                    data-jour="{{ jour }}" data-moment="{{ moment }}"
                    {% if menus[jour][moment] %}
                    data-menu-id="{{ menus[jour][moment].id }}"
                    {% if menus[jour][moment].recette %}
                    data-recette-id="{{ menus[jour][moment].recette.id }}"
                    draggable="true"
                    {% endif %}
                    {% endif %}>
                    {% if menus[jour][moment] %}
                        <div class="menu-content">
                            {% if menus[jour][moment].recette %}
                                <strong>{{ menus[jour][moment].recette.nom }}</strong>
                            {% else %}
                                {{ menus[jour][moment].description or 'Cliquez pour ajouter' }}
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="menu-content empty">
                            Cliquez pour ajouter
                        </div>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal pour √©diter un menu -->
<div id="menu-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
            <button type="submit" form="menu-form" class="btn-icon btn-icon-success" title="Enregistrer">‚úî</button>
            <button type="button" class="btn-icon btn-icon-danger" id="delete-menu" style="display:none;" title="Supprimer">üóë</button>
        </div>
        <form id="menu-form">
            <input type="hidden" id="menu-jour">
            <input type="hidden" id="menu-moment">
            <input type="hidden" id="menu-semaine" value="{{ semaine }}">
            
            <div class="form-group">
                <label for="menu-recette">Recette:</label>
                <select id="menu-recette" style="width: 100%;">
                    <option value="">Aucune recette</option>
                    {% for recette in recettes %}
                    <option value="{{ recette.id }}">{{ recette.nom }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 0.5rem; margin-top: 1rem;">
                <button type="button" class="btn-icon btn-icon-secondary" id="create-recipe-btn" title="Cr√©er une nouvelle recette">+</button>
                <button type="button" class="btn-icon btn-icon-info" id="edit-recipe-btn" style="display:none;" title="Modifier la recette">‚úèÔ∏è</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal pour cr√©er une recette -->
<div id="recette-modal" class="modal">
    <div class="modal-content">
        <span class="close" data-modal="recette-modal">&times;</span>
        <h3>Cr√©er une recette</h3>
        <form id="recette-form">
            <div class="form-group">
                <label for="recette-nom">Nom de la recette:</label>
                <input type="text" id="recette-nom" required>
            </div>
            
            <div class="form-group">
                <label for="recette-description">Instructions:</label>
                <textarea id="recette-description" rows="5"></textarea>
            </div>
            
            <div class="form-group">
                <label>Ingr√©dients:</label>
                <div id="ingredients-list"></div>
                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                    <select id="ingredient-select" style="flex: 1;">
                        <option value="">S√©lectionner un ingr√©dient...</option>
                        {% for ingredient in ingredients %}
                        <option value="{{ ingredient.id }}">{{ ingredient.nom }}</option>
                        {% endfor %}
                    </select>
                    <button type="button" class="btn btn-secondary" id="add-ingredient-btn">+</button>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Cr√©er et s√©lectionner</button>
                <button type="button" class="btn btn-secondary" id="cancel-recette">Annuler</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal pour modifier une recette -->
<div id="edit-recette-modal" class="modal">
    <div class="modal-content">
        <span class="close" data-modal="edit-recette-modal">&times;</span>
        <h3>Modifier la recette</h3>
        <form id="edit-recette-form">
            <input type="hidden" id="edit-recette-id">
            
            <div class="form-group">
                <label for="edit-recette-nom">Nom de la recette:</label>
                <input type="text" id="edit-recette-nom" required>
            </div>
            
            <div class="form-group">
                <label for="edit-recette-description">Instructions:</label>
                <textarea id="edit-recette-description" rows="5"></textarea>
            </div>
            
            <div class="form-group">
                <label>Ingr√©dients:</label>
                <div id="edit-ingredients-list"></div>
                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                    <select id="edit-ingredient-select" style="flex: 1;">
                        <option value="">S√©lectionner un ingr√©dient...</option>
                        {% for ingredient in ingredients %}
                        <option value="{{ ingredient.id }}">{{ ingredient.nom }}</option>
                        {% endfor %}
                    </select>
                    <button type="button" class="btn btn-secondary" id="edit-add-ingredient-btn">+</button>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Enregistrer</button>
                <button type="button" class="btn btn-secondary" id="cancel-edit-recette">Annuler</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/planner.js') }}"></script>
{% endblock %}
